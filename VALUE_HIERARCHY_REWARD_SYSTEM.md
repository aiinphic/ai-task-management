# åƒ¹å€¼å±¤ç´šèˆ‡çå‹µç³»çµ±è¨­è¨ˆ

å»ºç«‹æ—¥æœŸ: 2025-11-27  
ç‰ˆæœ¬: v1.0

---

## ğŸ¯ æ ¸å¿ƒå•é¡Œ

**å•é¡Œ 4**: AI ä»»å‹™ç®¡ç†ç³»çµ±çš„åº•å±¤é‚è¼¯å¦‚ä½•å¼·åˆ¶å»ºç«‹ã€Œä¸€ç´šå¤§æ–¼äºŒç´šå¤§æ–¼ä¸‰ç´šã€çš„åƒ¹å€¼è§€,ä¸¦ä¿è­‰åœ¨ç™¼æ”¾çé‡‘æ™‚,ä½ç´šä»»å‹™çš„çé‡‘ä¸å¯èƒ½å¤§æ–¼é«˜ç´šä»»å‹™?

**å•é¡Œ 5**: åœ¨ä»»å‹™åƒ¹å€¼åˆ¤æ–·ä¸Š,ç³»çµ±å¦‚ä½•è™•ç†ã€Œæ¥µç«¯å€¼ã€çš„ä¾‹å¤–æƒ…æ³,ä¾‹å¦‚:äºŒç´šä»»å‹™ä¸­ã€Œé‡ä¸­ä¹‹é‡ã€çš„çé‡‘æˆ–æ¬Šé‡,å¦‚ä½•èƒ½è¢«è¨­è¨ˆæˆæœ‰æ¢ä»¶åœ°å¤§æ–¼ä¸€ç´šä»»å‹™ä¸­ã€Œè¼•ã€çš„éƒ¨åˆ†?

---

## ğŸ’¡ è¨­è¨ˆå“²å­¸

### æ ¸å¿ƒåŸå‰‡

1. **çµ•å°å±¤ç´š** - ç­‰ç´šåˆ¶åº¦ä¸å¯å‹•æ–
2. **ç›¸å°æ¬Šé‡** - åŒç´šå…§å¯æœ‰å·®ç•°
3. **æ•¸å­¸å¼·åˆ¶** - ç”¨å…¬å¼ä¿è­‰è¦å‰‡
4. **ä¾‹å¤–å¯æ§** - æ¥µç«¯æƒ…æ³æœ‰æ˜ç¢ºé‚Šç•Œ

---

## ğŸ—ï¸ åƒ¹å€¼å±¤ç´šç³»çµ±æ¶æ§‹

### ä¸‰å±¤åƒ¹å€¼é«”ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ç´š|ç‡Ÿæ”¶ (Revenue)                              â”‚
â”‚  åŸºç¤åˆ†: 1000-2000                              â”‚
â”‚  æˆ°ç•¥é‡è¦æ€§: æœ€é«˜                               â”‚
â”‚  çé‡‘ä¿‚æ•¸: 3.0-5.0                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2ç´š|æµé‡ (Traffic)                             â”‚
â”‚  åŸºç¤åˆ†: 500-999                                â”‚
â”‚  æˆ°ç•¥é‡è¦æ€§: é«˜                                 â”‚
â”‚  çé‡‘ä¿‚æ•¸: 1.5-2.9                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3ç´š|è¡Œæ”¿ (Administrative)                      â”‚
â”‚  åŸºç¤åˆ†: 100-499                                â”‚
â”‚  æˆ°ç•¥é‡è¦æ€§: ä¸­                                 â”‚
â”‚  çé‡‘ä¿‚æ•¸: 0.5-1.4                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ•¸å­¸å¼·åˆ¶æ©Ÿåˆ¶

### 1. åŸºç¤åˆ†æ•¸ç¯„åœè¨­è¨ˆ

```typescript
// åƒ¹å€¼å±¤ç´šå®šç¾©
const VALUE_TIERS = {
  LEVEL_1_REVENUE: {
    name: '1ç´š|ç‡Ÿæ”¶',
    baseScoreRange: { min: 1000, max: 2000 },
    rewardMultiplierRange: { min: 3.0, max: 5.0 },
    strategicWeight: 1.0,
  },
  LEVEL_2_TRAFFIC: {
    name: '2ç´š|æµé‡',
    baseScoreRange: { min: 500, max: 999 },
    rewardMultiplierRange: { min: 1.5, max: 2.9 },
    strategicWeight: 0.7,
  },
  LEVEL_3_ADMIN: {
    name: '3ç´š|è¡Œæ”¿',
    baseScoreRange: { min: 100, max: 499 },
    rewardMultiplierRange: { min: 0.5, max: 1.4 },
    strategicWeight: 0.4,
  },
};

// é—œéµè¨­è¨ˆ: ä»»ä½• 2 ç´šä»»å‹™çš„æœ€å¤§åˆ†æ•¸ (999) < ä»»ä½• 1 ç´šä»»å‹™çš„æœ€å°åˆ†æ•¸ (1000)
// é€™ç¢ºä¿äº†çµ•å°çš„å±¤ç´šå„ªå…ˆé †åº
```

### 2. ä»»å‹™åƒ¹å€¼è¨ˆç®—å…¬å¼

```typescript
interface TaskValue {
  baseScore: number;        // åŸºç¤åˆ†æ•¸
  impactMultiplier: number; // å½±éŸ¿å€æ•¸
  urgencyBonus: number;     // ç·Šæ€¥åŠ æˆ
  finalScore: number;       // æœ€çµ‚åˆ†æ•¸
}

function calculateTaskValue(task: Task): TaskValue {
  // 2.1 ç¢ºå®šåŸºç¤åˆ†æ•¸ç¯„åœ
  const tier = VALUE_TIERS[task.level];
  
  // 2.2 æ ¹æ“šä»»å‹™å±¬æ€§è¨ˆç®—åŸºç¤åˆ†æ•¸ (åœ¨ç¯„åœå…§)
  let baseScore = calculateBaseScore(task, tier);
  
  // ç¢ºä¿åŸºç¤åˆ†æ•¸åœ¨ç¯„åœå…§
  baseScore = Math.max(tier.baseScoreRange.min, baseScore);
  baseScore = Math.min(tier.baseScoreRange.max, baseScore);
  
  // 2.3 è¨ˆç®—å½±éŸ¿å€æ•¸ (1.0 - 2.0)
  const impactMultiplier = calculateImpactMultiplier(task);
  
  // 2.4 è¨ˆç®—ç·Šæ€¥åŠ æˆ (0 - 200)
  const urgencyBonus = calculateUrgencyBonus(task);
  
  // 2.5 è¨ˆç®—æœ€çµ‚åˆ†æ•¸
  const finalScore = (baseScore * impactMultiplier) + urgencyBonus;
  
  return {
    baseScore,
    impactMultiplier,
    urgencyBonus,
    finalScore,
  };
}
```

### 3. åŸºç¤åˆ†æ•¸è¨ˆç®—

```typescript
function calculateBaseScore(task: Task, tier: ValueTier): number {
  const { min, max } = tier.baseScoreRange;
  const range = max - min;
  
  let score = min; // å¾æœ€å°å€¼é–‹å§‹
  
  // 3.1 é æœŸå½±éŸ¿ (40%)
  const impactScore = calculateImpactScore(task);
  score += range * 0.4 * (impactScore / 100);
  
  // 3.2 æˆ°ç•¥é‡è¦æ€§ (30%)
  const strategicScore = calculateStrategicScore(task);
  score += range * 0.3 * (strategicScore / 100);
  
  // 3.3 è¤‡é›œåº¦ (20%)
  const complexityScore = calculateComplexityScore(task);
  score += range * 0.2 * (complexityScore / 100);
  
  // 3.4 ä¾è³´å½±éŸ¿ (10%)
  const dependencyScore = calculateDependencyScore(task);
  score += range * 0.1 * (dependencyScore / 100);
  
  return Math.round(score);
}
```

### 4. å½±éŸ¿å€æ•¸è¨ˆç®—

```typescript
function calculateImpactMultiplier(task: Task): number {
  let multiplier = 1.0;
  
  // 4.1 é æœŸç‡Ÿæ”¶å½±éŸ¿
  if (task.expectedRevenue) {
    if (task.expectedRevenue >= 1000000) {
      multiplier += 0.5; // ç™¾è¬ç´šç‡Ÿæ”¶ +50%
    } else if (task.expectedRevenue >= 500000) {
      multiplier += 0.3; // 50è¬ç´šç‡Ÿæ”¶ +30%
    } else if (task.expectedRevenue >= 100000) {
      multiplier += 0.2; // 10è¬ç´šç‡Ÿæ”¶ +20%
    }
  }
  
  // 4.2 ç”¨æˆ¶å¢é•·å½±éŸ¿
  if (task.expectedUserGrowth) {
    if (task.expectedUserGrowth >= 10000) {
      multiplier += 0.4; // è¬ç´šç”¨æˆ¶å¢é•· +40%
    } else if (task.expectedUserGrowth >= 1000) {
      multiplier += 0.2; // åƒç´šç”¨æˆ¶å¢é•· +20%
    }
  }
  
  // 4.3 æ•ˆç‡æå‡å½±éŸ¿
  if (task.efficiencyGain) {
    multiplier += task.efficiencyGain * 0.01; // æ¯ 1% æ•ˆç‡æå‡ +1% å€æ•¸
  }
  
  // é™åˆ¶å€æ•¸ç¯„åœ 1.0 - 2.0
  return Math.min(2.0, multiplier);
}
```

### 5. ç·Šæ€¥åŠ æˆè¨ˆç®—

```typescript
function calculateUrgencyBonus(task: Task): number {
  const hoursUntilDeadline = getHoursUntilDeadline(task);
  let bonus = 0;
  
  // ç·Šæ€¥åŠ æˆæœ€å¤š 200 åˆ†
  if (hoursUntilDeadline <= 0) {
    bonus = 200; // å·²é€¾æœŸ
  } else if (hoursUntilDeadline <= 2) {
    bonus = 150; // 2å°æ™‚å…§
  } else if (hoursUntilDeadline <= 4) {
    bonus = 100; // 4å°æ™‚å…§
  } else if (hoursUntilDeadline <= 8) {
    bonus = 50;  // ä»Šæ—¥å…§
  } else if (hoursUntilDeadline <= 24) {
    bonus = 20;  // æ˜æ—¥å…§
  }
  
  return bonus;
}
```

---

## ğŸ çé‡‘è¨ˆç®—ç³»çµ±

### 1. çé‡‘è¨ˆç®—å…¬å¼

```typescript
interface TaskReward {
  baseReward: number;       // åŸºç¤çé‡‘
  performanceBonus: number; // ç¸¾æ•ˆåŠ æˆ
  qualityBonus: number;     // å“è³ªåŠ æˆ
  speedBonus: number;       // é€Ÿåº¦åŠ æˆ
  totalReward: number;      // ç¸½çé‡‘
}

function calculateTaskReward(
  task: Task,
  completion: TaskCompletion
): TaskReward {
  // 1.1 ç¢ºå®šçé‡‘ä¿‚æ•¸ç¯„åœ
  const tier = VALUE_TIERS[task.level];
  
  // 1.2 è¨ˆç®—åŸºç¤çé‡‘ä¿‚æ•¸ (åœ¨ç¯„åœå…§)
  let rewardMultiplier = calculateRewardMultiplier(task, tier);
  
  // ç¢ºä¿ä¿‚æ•¸åœ¨ç¯„åœå…§
  rewardMultiplier = Math.max(tier.rewardMultiplierRange.min, rewardMultiplier);
  rewardMultiplier = Math.min(tier.rewardMultiplierRange.max, rewardMultiplier);
  
  // 1.3 è¨ˆç®—åŸºç¤çé‡‘
  const baseReward = task.baseScore * rewardMultiplier;
  
  // 1.4 è¨ˆç®—ç¸¾æ•ˆåŠ æˆ
  const performanceBonus = calculatePerformanceBonus(task, completion);
  
  // 1.5 è¨ˆç®—å“è³ªåŠ æˆ
  const qualityBonus = calculateQualityBonus(completion);
  
  // 1.6 è¨ˆç®—é€Ÿåº¦åŠ æˆ
  const speedBonus = calculateSpeedBonus(task, completion);
  
  // 1.7 è¨ˆç®—ç¸½çé‡‘
  const totalReward = baseReward + performanceBonus + qualityBonus + speedBonus;
  
  return {
    baseReward,
    performanceBonus,
    qualityBonus,
    speedBonus,
    totalReward,
  };
}
```

### 2. çé‡‘ä¿‚æ•¸è¨ˆç®—

```typescript
function calculateRewardMultiplier(task: Task, tier: ValueTier): number {
  const { min, max } = tier.rewardMultiplierRange;
  const range = max - min;
  
  let multiplier = min; // å¾æœ€å°å€¼é–‹å§‹
  
  // 2.1 ä»»å‹™é›£åº¦ (40%)
  const difficultyScore = calculateDifficultyScore(task);
  multiplier += range * 0.4 * (difficultyScore / 100);
  
  // 2.2 é æœŸå½±éŸ¿ (30%)
  const impactScore = calculateImpactScore(task);
  multiplier += range * 0.3 * (impactScore / 100);
  
  // 2.3 é¢¨éšªç¨‹åº¦ (20%)
  const riskScore = calculateRiskScore(task);
  multiplier += range * 0.2 * (riskScore / 100);
  
  // 2.4 ç¨€ç¼ºæ€§ (10%)
  const scarcityScore = calculateScarcityScore(task);
  multiplier += range * 0.1 * (scarcityScore / 100);
  
  return multiplier;
}
```

### 3. ç¸¾æ•ˆåŠ æˆè¨ˆç®—

```typescript
function calculatePerformanceBonus(
  task: Task,
  completion: TaskCompletion
): number {
  let bonus = 0;
  
  // 3.1 ç›®æ¨™é”æˆç‡
  const achievementRate = completion.achievementRate || 1.0;
  if (achievementRate > 1.0) {
    // è¶…é¡å®Œæˆ,æ¯è¶…é 10% åŠ æˆ 5%
    bonus += task.baseScore * (achievementRate - 1.0) * 0.5;
  }
  
  // 3.2 å½±éŸ¿åŠ›å¯¦ç¾
  if (completion.actualRevenue && task.expectedRevenue) {
    const revenueRate = completion.actualRevenue / task.expectedRevenue;
    if (revenueRate > 1.0) {
      bonus += task.baseScore * (revenueRate - 1.0) * 0.3;
    }
  }
  
  return Math.round(bonus);
}
```

### 4. å“è³ªåŠ æˆè¨ˆç®—

```typescript
function calculateQualityBonus(completion: TaskCompletion): number {
  const qualityScores = {
    'excellent': 0.3,  // å“è¶Šå“è³ª +30%
    'good': 0.15,      // è‰¯å¥½å“è³ª +15%
    'acceptable': 0,   // å¯æ¥å—å“è³ª +0%
    'poor': -0.2,      // å“è³ªä¸ä½³ -20%
  };
  
  const qualityMultiplier = qualityScores[completion.quality] || 0;
  return Math.round(completion.task.baseScore * qualityMultiplier);
}
```

### 5. é€Ÿåº¦åŠ æˆè¨ˆç®—

```typescript
function calculateSpeedBonus(
  task: Task,
  completion: TaskCompletion
): number {
  const estimatedTime = task.estimatedMinutes;
  const actualTime = completion.actualMinutes;
  
  // å¦‚æœæå‰å®Œæˆ
  if (actualTime < estimatedTime) {
    const timeSaved = estimatedTime - actualTime;
    const savingRate = timeSaved / estimatedTime;
    
    // æ¯ç¯€çœ 10% æ™‚é–“,åŠ æˆ 5%
    const bonus = task.baseScore * savingRate * 0.5;
    
    // æœ€å¤šåŠ æˆ 20%
    return Math.min(task.baseScore * 0.2, Math.round(bonus));
  }
  
  return 0;
}
```

---

## âš–ï¸ å±¤ç´šå¼·åˆ¶æ©Ÿåˆ¶

### 1. æ•¸å­¸ä¿è­‰

```typescript
// é©—è­‰å‡½æ•¸:ç¢ºä¿å±¤ç´šè¦å‰‡ä¸è¢«æ‰“ç ´
function validateTaskValue(task: Task, value: TaskValue): boolean {
  const tier = VALUE_TIERS[task.level];
  
  // 1.1 åŸºç¤åˆ†æ•¸å¿…é ˆåœ¨ç¯„åœå…§
  if (value.baseScore < tier.baseScoreRange.min || 
      value.baseScore > tier.baseScoreRange.max) {
    throw new Error(
      `ä»»å‹™åŸºç¤åˆ†æ•¸ ${value.baseScore} è¶…å‡º ${task.level} ç¯„åœ ` +
      `[${tier.baseScoreRange.min}, ${tier.baseScoreRange.max}]`
    );
  }
  
  // 1.2 æœ€çµ‚åˆ†æ•¸ä¸èƒ½è¶…éä¸Šé™
  const maxPossibleScore = 
    tier.baseScoreRange.max * 2.0 + 200; // æœ€å¤§å€æ•¸ 2.0 + æœ€å¤§ç·Šæ€¥åŠ æˆ 200
  
  if (value.finalScore > maxPossibleScore) {
    throw new Error(
      `ä»»å‹™æœ€çµ‚åˆ†æ•¸ ${value.finalScore} è¶…éç†è«–ä¸Šé™ ${maxPossibleScore}`
    );
  }
  
  return true;
}

// é©—è­‰å‡½æ•¸:ç¢ºä¿çé‡‘è¦å‰‡ä¸è¢«æ‰“ç ´
function validateTaskReward(task: Task, reward: TaskReward): boolean {
  const tier = VALUE_TIERS[task.level];
  
  // 2.1 åŸºç¤çé‡‘ä¿‚æ•¸å¿…é ˆåœ¨ç¯„åœå…§
  const actualMultiplier = reward.baseReward / task.baseScore;
  
  if (actualMultiplier < tier.rewardMultiplierRange.min || 
      actualMultiplier > tier.rewardMultiplierRange.max) {
    throw new Error(
      `çé‡‘ä¿‚æ•¸ ${actualMultiplier.toFixed(2)} è¶…å‡º ${task.level} ç¯„åœ ` +
      `[${tier.rewardMultiplierRange.min}, ${tier.rewardMultiplierRange.max}]`
    );
  }
  
  // 2.2 ç¸½çé‡‘ä¸èƒ½è¶…éåˆç†ä¸Šé™
  const maxPossibleReward = 
    tier.baseScoreRange.max * tier.rewardMultiplierRange.max * 2.0;
    // åŸºç¤åˆ†æ•¸ä¸Šé™ Ã— ä¿‚æ•¸ä¸Šé™ Ã— 2.0 (è€ƒæ…®æ‰€æœ‰åŠ æˆ)
  
  if (reward.totalReward > maxPossibleReward) {
    throw new Error(
      `ç¸½çé‡‘ ${reward.totalReward} è¶…éç†è«–ä¸Šé™ ${maxPossibleReward}`
    );
  }
  
  return true;
}
```

### 2. å±¤ç´šæ¯”è¼ƒä¿è­‰

```typescript
// ç¢ºä¿ä»»ä½•æƒ…æ³ä¸‹,ä½ç´šä»»å‹™çé‡‘ä¸æœƒè¶…éé«˜ç´šä»»å‹™
function ensureHierarchyIntegrity(): void {
  // è¨ˆç®—å„å±¤ç´šçš„ç†è«–çé‡‘ç¯„åœ
  
  // 1ç´šæœ€å°å¯èƒ½çé‡‘
  const level1MinReward = 
    VALUE_TIERS.LEVEL_1_REVENUE.baseScoreRange.min * 
    VALUE_TIERS.LEVEL_1_REVENUE.rewardMultiplierRange.min;
  
  // 2ç´šæœ€å¤§å¯èƒ½çé‡‘ (åŒ…å«æ‰€æœ‰åŠ æˆ)
  const level2MaxReward = 
    VALUE_TIERS.LEVEL_2_TRAFFIC.baseScoreRange.max * 
    VALUE_TIERS.LEVEL_2_TRAFFIC.rewardMultiplierRange.max * 
    2.0; // è€ƒæ…®æ‰€æœ‰åŠ æˆæœ€å¤š 2 å€
  
  // 2ç´šæœ€å°å¯èƒ½çé‡‘
  const level2MinReward = 
    VALUE_TIERS.LEVEL_2_TRAFFIC.baseScoreRange.min * 
    VALUE_TIERS.LEVEL_2_TRAFFIC.rewardMultiplierRange.min;
  
  // 3ç´šæœ€å¤§å¯èƒ½çé‡‘ (åŒ…å«æ‰€æœ‰åŠ æˆ)
  const level3MaxReward = 
    VALUE_TIERS.LEVEL_3_ADMIN.baseScoreRange.max * 
    VALUE_TIERS.LEVEL_3_ADMIN.rewardMultiplierRange.max * 
    2.0;
  
  // é©—è­‰å±¤ç´šå®Œæ•´æ€§
  console.log('å±¤ç´šçé‡‘ç¯„åœé©—è­‰:');
  console.log(`1ç´š: ${level1MinReward.toFixed(0)} - ${(level1MinReward * 10).toFixed(0)}`);
  console.log(`2ç´š: ${level2MinReward.toFixed(0)} - ${level2MaxReward.toFixed(0)}`);
  console.log(`3ç´š: ${(level3MaxReward * 0.1).toFixed(0)} - ${level3MaxReward.toFixed(0)}`);
  
  // é—œéµé©—è­‰:2ç´šæœ€å¤§çé‡‘ < 1ç´šæœ€å°çé‡‘
  if (level2MaxReward >= level1MinReward) {
    throw new Error(
      `å±¤ç´šå®Œæ•´æ€§è¢«ç ´å£! 2ç´šæœ€å¤§çé‡‘ (${level2MaxReward}) ` +
      `>= 1ç´šæœ€å°çé‡‘ (${level1MinReward})`
    );
  }
  
  // é—œéµé©—è­‰:3ç´šæœ€å¤§çé‡‘ < 2ç´šæœ€å°çé‡‘
  if (level3MaxReward >= level2MinReward) {
    throw new Error(
      `å±¤ç´šå®Œæ•´æ€§è¢«ç ´å£! 3ç´šæœ€å¤§çé‡‘ (${level3MaxReward}) ` +
      `>= 2ç´šæœ€å°çé‡‘ (${level2MinReward})`
    );
  }
  
  console.log('âœ“ å±¤ç´šå®Œæ•´æ€§é©—è­‰é€šé');
}
```

---

## ğŸ”¥ æ¥µç«¯å€¼è™•ç†æ©Ÿåˆ¶

### å•é¡Œå ´æ™¯

**å ´æ™¯**: 2ç´šä»»å‹™ä¸­çš„ã€Œé‡ä¸­ä¹‹é‡ã€vs 1ç´šä»»å‹™ä¸­çš„ã€Œè¼•é‡ç´šã€

**éœ€æ±‚**: åœ¨ç‰¹å®šæ¢ä»¶ä¸‹,å…è¨± 2 ç´šé‡è¦ä»»å‹™çš„çé‡‘è¶…é 1 ç´šè¼•é‡ä»»å‹™

### è§£æ±ºæ–¹æ¡ˆ:ã€Œè·¨ç´šåŠ æˆã€æ©Ÿåˆ¶

```typescript
interface CrossTierBonus {
  enabled: boolean;
  conditions: string[];
  maxBonus: number;
  actualBonus: number;
}

function calculateCrossTierBonus(
  task: Task,
  completion: TaskCompletion
): CrossTierBonus {
  // é è¨­ä¸å•Ÿç”¨
  let bonus: CrossTierBonus = {
    enabled: false,
    conditions: [],
    maxBonus: 0,
    actualBonus: 0,
  };
  
  // åªæœ‰ 2 ç´šå’Œ 3 ç´šä»»å‹™å¯èƒ½ç²å¾—è·¨ç´šåŠ æˆ
  if (task.level === 'LEVEL_1_REVENUE') {
    return bonus;
  }
  
  // æª¢æŸ¥æ˜¯å¦æ»¿è¶³è·¨ç´šåŠ æˆæ¢ä»¶
  const conditions = checkCrossTierConditions(task, completion);
  
  if (conditions.length >= 3) { // è‡³å°‘æ»¿è¶³ 3 å€‹æ¢ä»¶
    bonus.enabled = true;
    bonus.conditions = conditions;
    
    // è¨ˆç®—è·¨ç´šåŠ æˆ
    const tier = VALUE_TIERS[task.level];
    const nextTier = getNextTier(task.level);
    
    if (nextTier) {
      // æœ€å¤šå¯ä»¥åŠ æˆåˆ°ä¸‹ä¸€ç´šçš„æœ€å°å€¼
      const currentMaxReward = 
        tier.baseScoreRange.max * tier.rewardMultiplierRange.max * 2.0;
      
      const nextMinReward = 
        nextTier.baseScoreRange.min * nextTier.rewardMultiplierRange.min;
      
      bonus.maxBonus = nextMinReward - currentMaxReward;
      
      // æ ¹æ“šæ»¿è¶³æ¢ä»¶æ•¸é‡è¨ˆç®—å¯¦éš›åŠ æˆ
      const conditionRate = Math.min(conditions.length / 5, 1.0);
      bonus.actualBonus = Math.round(bonus.maxBonus * conditionRate);
    }
  }
  
  return bonus;
}
```

### è·¨ç´šåŠ æˆæ¢ä»¶

```typescript
function checkCrossTierConditions(
  task: Task,
  completion: TaskCompletion
): string[] {
  const conditions: string[] = [];
  
  // æ¢ä»¶ 1: è¶…é¡å®Œæˆ (é”æˆç‡ > 150%)
  if (completion.achievementRate >= 1.5) {
    conditions.push('è¶…é¡å®Œæˆ 150%');
  }
  
  // æ¢ä»¶ 2: å“è¶Šå“è³ª
  if (completion.quality === 'excellent') {
    conditions.push('å“è¶Šå“è³ª');
  }
  
  // æ¢ä»¶ 3: é¡¯è‘—æå‰å®Œæˆ (ç¯€çœ > 30% æ™‚é–“)
  const timeSavingRate = 
    (task.estimatedMinutes - completion.actualMinutes) / task.estimatedMinutes;
  if (timeSavingRate >= 0.3) {
    conditions.push(`æå‰å®Œæˆ ${(timeSavingRate * 100).toFixed(0)}%`);
  }
  
  // æ¢ä»¶ 4: å¯¦éš›å½±éŸ¿è¶…å‡ºé æœŸ (ç‡Ÿæ”¶/ç”¨æˆ¶å¢é•· > 200%)
  if (completion.actualRevenue && task.expectedRevenue) {
    const revenueRate = completion.actualRevenue / task.expectedRevenue;
    if (revenueRate >= 2.0) {
      conditions.push(`ç‡Ÿæ”¶è¶…å‡ºé æœŸ ${((revenueRate - 1) * 100).toFixed(0)}%`);
    }
  }
  
  // æ¢ä»¶ 5: é›¶å•é¡Œå®Œæˆ
  if (completion.issuesEncountered === 0) {
    conditions.push('é›¶å•é¡Œå®Œæˆ');
  }
  
  // æ¢ä»¶ 6: é«˜é›£åº¦ä»»å‹™
  const difficultyScore = calculateDifficultyScore(task);
  if (difficultyScore >= 90) {
    conditions.push('é«˜é›£åº¦ä»»å‹™');
  }
  
  // æ¢ä»¶ 7: æˆ°ç•¥é—œéµä»»å‹™
  if (task.isStrategicKey) {
    conditions.push('æˆ°ç•¥é—œéµä»»å‹™');
  }
  
  return conditions;
}
```

### è·¨ç´šåŠ æˆæ‡‰ç”¨

```typescript
function applyFinalReward(
  task: Task,
  completion: TaskCompletion
): FinalReward {
  // 1. è¨ˆç®—åŸºç¤çé‡‘
  const baseReward = calculateTaskReward(task, completion);
  
  // 2. æª¢æŸ¥è·¨ç´šåŠ æˆ
  const crossTierBonus = calculateCrossTierBonus(task, completion);
  
  // 3. æ‡‰ç”¨è·¨ç´šåŠ æˆ
  let finalReward = baseReward.totalReward;
  
  if (crossTierBonus.enabled) {
    finalReward += crossTierBonus.actualBonus;
    
    // è¨˜éŒ„è·¨ç´šåŠ æˆäº‹ä»¶
    logCrossTierBonusEvent({
      taskId: task.id,
      taskLevel: task.level,
      baseReward: baseReward.totalReward,
      crossTierBonus: crossTierBonus.actualBonus,
      finalReward,
      conditions: crossTierBonus.conditions,
      timestamp: new Date(),
    });
  }
  
  // 4. é©—è­‰æœ€çµ‚çé‡‘
  validateFinalReward(task, finalReward, crossTierBonus);
  
  return {
    ...baseReward,
    crossTierBonus,
    finalReward,
  };
}
```

### è·¨ç´šåŠ æˆé©—è­‰

```typescript
function validateFinalReward(
  task: Task,
  finalReward: number,
  crossTierBonus: CrossTierBonus
): void {
  const tier = VALUE_TIERS[task.level];
  const nextTier = getNextTier(task.level);
  
  // å³ä½¿æœ‰è·¨ç´šåŠ æˆ,ä¹Ÿä¸èƒ½è¶…éä¸‹ä¸€ç´šçš„å¹³å‡å€¼
  if (nextTier) {
    const nextTierAvg = 
      (nextTier.baseScoreRange.min + nextTier.baseScoreRange.max) / 2 *
      (nextTier.rewardMultiplierRange.min + nextTier.rewardMultiplierRange.max) / 2;
    
    if (finalReward > nextTierAvg) {
      throw new Error(
        `è·¨ç´šåŠ æˆå¾Œçš„çé‡‘ ${finalReward} è¶…éä¸‹ä¸€ç´šå¹³å‡å€¼ ${nextTierAvg.toFixed(0)}`
      );
    }
  }
  
  // è¨˜éŒ„è­¦å‘Š
  if (crossTierBonus.enabled) {
    console.warn(
      `âš ï¸  è·¨ç´šåŠ æˆè§¸ç™¼: ${task.level} ä»»å‹™ç²å¾— ${crossTierBonus.actualBonus} åŠ æˆ\n` +
      `æ¢ä»¶: ${crossTierBonus.conditions.join(', ')}\n` +
      `æœ€çµ‚çé‡‘: ${finalReward}`
    );
  }
}
```

---

## ğŸ“Š çé‡‘åˆ†ä½ˆè¦–è¦ºåŒ–

### ç†è«–çé‡‘ç¯„åœ

```
1ç´š|ç‡Ÿæ”¶ä»»å‹™çé‡‘ç¯„åœ:
â”œâ”€ æœ€å°: 3,000  (åŸºç¤åˆ† 1000 Ã— ä¿‚æ•¸ 3.0)
â”œâ”€ å…¸å‹: 7,500  (åŸºç¤åˆ† 1500 Ã— ä¿‚æ•¸ 5.0)
â””â”€ æœ€å¤§: 20,000 (åŸºç¤åˆ† 2000 Ã— ä¿‚æ•¸ 5.0 Ã— åŠ æˆ 2.0)

2ç´š|æµé‡ä»»å‹™çé‡‘ç¯„åœ:
â”œâ”€ æœ€å°: 750    (åŸºç¤åˆ† 500 Ã— ä¿‚æ•¸ 1.5)
â”œâ”€ å…¸å‹: 2,175  (åŸºç¤åˆ† 750 Ã— ä¿‚æ•¸ 2.9)
â”œâ”€ æœ€å¤§: 5,794  (åŸºç¤åˆ† 999 Ã— ä¿‚æ•¸ 2.9 Ã— åŠ æˆ 2.0)
â””â”€ è·¨ç´šæœ€å¤§: 3,000 (å¯åŠ æˆè‡³ 1 ç´šæœ€å°å€¼,éœ€æ»¿è¶³æ¢ä»¶)

3ç´š|è¡Œæ”¿ä»»å‹™çé‡‘ç¯„åœ:
â”œâ”€ æœ€å°: 50     (åŸºç¤åˆ† 100 Ã— ä¿‚æ•¸ 0.5)
â”œâ”€ å…¸å‹: 420    (åŸºç¤åˆ† 300 Ã— ä¿‚æ•¸ 1.4)
â”œâ”€ æœ€å¤§: 1,397  (åŸºç¤åˆ† 499 Ã— ä¿‚æ•¸ 1.4 Ã— åŠ æˆ 2.0)
â””â”€ è·¨ç´šæœ€å¤§: 750 (å¯åŠ æˆè‡³ 2 ç´šæœ€å°å€¼,éœ€æ»¿è¶³æ¢ä»¶)
```

---

## ğŸ¯ å¯¦ä½œæª¢æŸ¥æ¸…å–®

### éšæ®µ 1: åŸºç¤ç³»çµ±
- [ ] å®šç¾©åƒ¹å€¼å±¤ç´šå¸¸æ•¸
- [ ] å¯¦ä½œåŸºç¤åˆ†æ•¸è¨ˆç®—
- [ ] å¯¦ä½œå½±éŸ¿å€æ•¸è¨ˆç®—
- [ ] å¯¦ä½œç·Šæ€¥åŠ æˆè¨ˆç®—
- [ ] å¯¦ä½œå±¤ç´šé©—è­‰æ©Ÿåˆ¶

### éšæ®µ 2: çé‡‘ç³»çµ±
- [ ] å¯¦ä½œçé‡‘ä¿‚æ•¸è¨ˆç®—
- [ ] å¯¦ä½œç¸¾æ•ˆåŠ æˆè¨ˆç®—
- [ ] å¯¦ä½œå“è³ªåŠ æˆè¨ˆç®—
- [ ] å¯¦ä½œé€Ÿåº¦åŠ æˆè¨ˆç®—
- [ ] å¯¦ä½œçé‡‘é©—è­‰æ©Ÿåˆ¶

### éšæ®µ 3: è·¨ç´šåŠ æˆ
- [ ] å®šç¾©è·¨ç´šåŠ æˆæ¢ä»¶
- [ ] å¯¦ä½œæ¢ä»¶æª¢æŸ¥é‚è¼¯
- [ ] å¯¦ä½œè·¨ç´šåŠ æˆè¨ˆç®—
- [ ] å¯¦ä½œè·¨ç´šåŠ æˆé©—è­‰
- [ ] å»ºç«‹è·¨ç´šåŠ æˆè¨˜éŒ„

### éšæ®µ 4: ç›£æ§èˆ‡å ±å‘Š
- [ ] å»ºç«‹çé‡‘åˆ†ä½ˆå ±å‘Š
- [ ] å¯¦ä½œç•°å¸¸åµæ¸¬
- [ ] å»ºç«‹å±¤ç´šå®Œæ•´æ€§ç›£æ§
- [ ] å¯¦ä½œè·¨ç´šåŠ æˆçµ±è¨ˆ

---

## ğŸ“ˆ é æœŸæ•ˆç›Š

### åƒ¹å€¼è§€å¼·åŒ–
- å“¡å·¥æ¸…æ¥šç†è§£ä»»å‹™åƒ¹å€¼å±¤ç´š
- è‡ªç„¶å‚¾å‘å„ªå…ˆè™•ç†é«˜åƒ¹å€¼ä»»å‹™
- æˆ°ç•¥ç›®æ¨™èˆ‡å€‹äººåˆ©ç›Šä¸€è‡´

### æ¿€å‹µæ•ˆæœ
- é«˜å“è³ªå®Œæˆç²å¾—é¡å¤–çå‹µ
- æå‰å®Œæˆç²å¾—é€Ÿåº¦åŠ æˆ
- å“è¶Šè¡¨ç¾å¯ç²è·¨ç´šåŠ æˆ

### å…¬å¹³æ€§ä¿è­‰
- æ•¸å­¸å…¬å¼ä¿è­‰è¦å‰‡å…¬å¹³
- å±¤ç´šå¼·åˆ¶æ©Ÿåˆ¶é˜²æ­¢æ¿«ç”¨
- è·¨ç´šåŠ æˆæœ‰æ˜ç¢ºæ¢ä»¶èˆ‡ä¸Šé™

---

**ç¸½çµ**: é€éæ•¸å­¸å¼·åˆ¶æ©Ÿåˆ¶ç¢ºä¿ã€Œä¸€ç´š > äºŒç´š > ä¸‰ç´šã€çš„çµ•å°å±¤ç´š,åŒæ™‚é€éã€Œè·¨ç´šåŠ æˆã€æ©Ÿåˆ¶è™•ç†æ¥µç«¯å„ªç§€è¡¨ç¾,åœ¨ä¿æŒå±¤ç´šå®Œæ•´æ€§çš„å‰æä¸‹,æ¿€å‹µå“¡å·¥è¿½æ±‚å“è¶Šã€‚
